<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…ã®ã—ãŠã‚Šãƒ¡ãƒ¼ã‚«ãƒ¼ v5.4</title>
    <meta name="robots" content="noindex, nofollow">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #FFF8F0; /* éå¸¸ã«è–„ã„ã‚ªãƒ¬ãƒ³ã‚¸ */
            color: #4E2600; /* é»’ã®ä»£ã‚ã‚Šã«æœ€ã‚‚æ¿ƒã„ã‚ªãƒ¬ãƒ³ã‚¸ãƒ–ãƒ©ã‚¦ãƒ³ */
            padding-top: 70px; 
            padding-bottom: 120px; 
        }
        
        .ad-banner {
            position: fixed; left: 0; right: 0; z-index: 50;
            background-color: #FFE0B2; color: #E65100;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold; border: 1px dashed #FFCC80;
        }
        .ad-top { top: 0; height: 60px; border-bottom-width: 1px; }
        .ad-bottom { bottom: 0; height: 60px; border-top-width: 1px; }

        .timeline-container { position: relative; padding-left: 20px; }
        .timeline-line { 
            position: absolute; left: 11px; top: 24px; bottom: -10px; 
            width: 2px; background-color: #FFD180; z-index: 0; 
        }
        .timeline-item:last-child .timeline-line { display: none; }
        
        .timeline-dot { 
            width: 24px; height: 24px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 10px; z-index: 10; background-color: #fff; border: 2px solid #FFB74D;
            flex-shrink: 0; margin-right: 12px; position: relative;
        }
        
        .input-hole {
            display: inline-block; border-bottom: 2px dashed #F57C00; color: #E65100;
            padding: 0 4px; cursor: pointer; transition: all 0.2s; font-weight: bold;
            min-width: 60px; text-align: center;
        }
        .input-hole.filled { border-bottom: none; color: #4E2600; pointer-events: auto; text-align: left; min-width: auto; } 
        .input-readonly { color: #4E2600; border-bottom: none; pointer-events: none; }
        .select-box {
            display: inline-flex; align-items: center; justify-content: center;
            border: 1px solid #FFB74D; background-color: #fff;
            padding: 2px 8px; border-radius: 4px; cursor: pointer;
            font-size: 0.75rem; color: #F57C00;
        }
        .toll-tag { font-size: 70%; vertical-align: baseline; margin-left: 2px; margin-right: 2px; color: #F57C00; }
        .modal-bg { background-color: rgba(78, 38, 0, 0.5); } /* ã‚ªãƒ¬ãƒ³ã‚¸ãƒ–ãƒ©ã‚¦ãƒ³ã®é€éèƒŒæ™¯ */
        
        @media print {
            .no-print, .ad-banner, header { display: none !important; }
            body { 
                background-color: #fff !important; 
                padding: 0 !important; margin: 0 !important; 
                width: 100%; 
                -webkit-print-color-adjust: exact; print-color-adjust: exact;
            }
            #app-content { padding: 0 !important; max-width: none !important; }
            .shadow-xl, .shadow-lg, .shadow-sm { box-shadow: none !important; border: none !important; }
            .bg-gradient-to-r { background: #F57C00 !important; color: white !important; }
            .timeline-item, .card { break-inside: avoid; page-break-inside: avoid; }
            #full-map-area { 
                height: 300px !important; width: 100% !important; 
                border: 1px solid #FFB74D !important; 
                break-inside: avoid;
            }
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOStiNglNEGEnPnhDxJG0RSQqgJXVtUQw&libraries=places,geometry&callback=initMap" async defer></script>
</head>
<body class="flex flex-col items-center min-h-screen">

    <div class="ad-banner ad-top no-print">
        <span>åºƒå‘Šæ  (Top) 320x50 / 320x100</span>
    </div>

    <header class="w-full bg-orange-600 text-white shadow-md z-40 no-print" style="position: sticky; top: 60px;">
        <div class="max-w-2xl mx-auto px-4 py-3 flex justify-between items-end">
            <div>
                <p class="text-[10px] text-orange-200 font-bold mb-0.5">è¤‡æ•°å€‹æ‰€å·¡ã‚Šãƒ—ãƒ©ãƒ³ç°¡å˜ä½œæˆ</p>
                <h1 class="text-lg font-extrabold flex items-center gap-2 cursor-pointer" onclick="goHome()">
                    <span>ğŸ“–</span> æ—…ã®ã—ãŠã‚Šãƒ¡ãƒ¼ã‚«ãƒ¼ <span class="text-[10px] bg-orange-500 px-1.5 py-0.5 rounded">v5.4</span>
                </h1>
            </div>
            <button onclick="goHome()" class="text-xs bg-orange-700 hover:bg-orange-800 px-3 py-1.5 rounded text-white font-bold transition">
                ğŸ  ãƒã‚¤ãƒšãƒ¼ã‚¸
            </button>
        </div>
    </header>

    <main id="app-content" class="w-full max-w-2xl p-2 sm:p-4"></main>

    <div class="ad-banner ad-bottom no-print">
        <span>åºƒå‘Šæ  (Bottom) 300x250 / 320x50</span>
    </div>

    <div id="modal-location" class="hidden fixed inset-0 modal-bg z-50 flex items-center justify-center p-4 no-print">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 relative">
            <h3 class="text-lg font-bold mb-4 text-orange-900">ğŸ“ åœ°ç‚¹ãƒ»æ–½è¨­åã®å…¥åŠ›</h3>
            <div class="flex gap-2 mb-2">
                <input type="text" id="input-loc-name" list="saved-locations-list" class="flex-1 p-2 border border-orange-200 rounded font-bold text-orange-900" placeholder="ä¾‹: æ±äº¬é§…">
                <button onclick="validateLocation()" class="bg-orange-100 text-orange-700 px-3 rounded font-bold whitespace-nowrap">ç¢ºå®š</button>
            </div>
            <p id="loc-search-res" class="text-xs text-orange-500 mb-4 h-4 truncate">â€»ç¢ºå®šã‚’æŠ¼ã—ã¦ä½æ‰€ã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
            <div class="flex justify-between items-center pt-2 border-t border-orange-100 mt-2">
                <button onclick="saveToDictionary()" class="text-xs text-orange-400 hover:text-orange-600">ğŸ’¾ è¾æ›¸ã«ä¿å­˜</button>
                <div class="flex gap-2">
                    <button onclick="closeModal('modal-location')" class="px-4 py-2 text-orange-400">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button onclick="confirmLocation()" class="px-6 py-2 bg-orange-600 text-white font-bold rounded shadow">OK</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-transport" class="hidden fixed inset-0 modal-bg z-50 flex items-center justify-center p-4 no-print">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6">
            <h3 class="text-lg font-bold mb-4 text-orange-900">ğŸš— ç§»å‹•æ‰‹æ®µãƒ»æ¸‹æ»è¨­å®š</h3>
            
            <label class="block text-xs font-bold text-orange-400 mb-1">ç§»å‹•ãƒ¢ãƒ¼ãƒ‰</label>
            <select id="input-transport" class="w-full p-3 border border-orange-200 rounded text-lg font-bold mb-4 text-orange-900">
                <option value="DRIVING_TOLL">ğŸï¸ è»Šï¼ˆæœ‰æ–™å„ªå…ˆï¼‰</option>
                <option value="DRIVING_FREE">ğŸš™ è»Šï¼ˆç„¡æ–™å„ªå…ˆï¼‰</option>
                <option value="WALKING">ğŸš¶ å¾’æ­©</option>
                <option value="BICYCLING">ğŸš² è‡ªè»¢è»Š</option>
            </select>

            <label class="block text-xs font-bold text-orange-400 mb-1">æ¸‹æ»è€ƒæ…® (ä½™è£•ã‚’ã‚‚ãŸã›ã‚‹)</label>
            <div class="bg-orange-50 p-3 rounded border border-orange-100 mb-6">
                <select id="input-traffic-buffer" class="w-full p-2 border border-orange-200 rounded font-bold text-orange-900">
                    <option value="0">ãªã— (APIè¨ˆç®—é€šã‚Š)</option>
                    <option value="10">ï¼‹10åˆ† ã®ä½™è£•ã‚’è¶³ã™</option>
                    <option value="20">ï¼‹20åˆ† ã®ä½™è£•ã‚’è¶³ã™</option>
                    <option value="30">ï¼‹30åˆ† ã®ä½™è£•ã‚’è¶³ã™</option>
                </select>
                <p class="text-[10px] text-orange-500 mt-1">â€»GoogleMapãƒŠãƒ“ã®å®Ÿæ™‚é–“ã«è¿‘ã„ã‚†ã¨ã‚Šã‚’æŒãŸã›ã¾ã™</p>
            </div>

            <div class="flex justify-end gap-2">
                <button onclick="closeModal('modal-transport')" class="px-4 py-2 text-orange-400">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="confirmTransport()" class="px-6 py-2 bg-orange-600 text-white font-bold rounded shadow">OK</button>
            </div>
        </div>
    </div>

    <div id="modal-stay" class="hidden fixed inset-0 modal-bg z-50 flex items-center justify-center p-4 no-print">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6">
            <h3 class="text-lg font-bold mb-4 text-orange-900">â³ æ»åœ¨ãƒ»åŸºç‚¹è¨­å®š</h3>
            <div class="mb-3">
                <label class="block text-xs font-bold text-orange-400">æ»åœ¨ç†ç”±</label>
                <input type="text" id="input-stay-reason" class="w-full p-2 border border-orange-200 rounded font-bold text-orange-900" placeholder="ä¾‹: æ˜¼é£Ÿ">
            </div>
            <div class="mb-3">
                <label class="block text-xs font-bold text-orange-400">æ»åœ¨æ™‚é–“</label>
                <select id="input-stay-time" class="w-full p-2 border border-orange-200 rounded font-bold text-orange-900">
                    <option value="0">0åˆ† (é€šé)</option>
                    <option value="10">10åˆ†</option><option value="20">20åˆ†</option><option value="30">30åˆ†</option>
                    <option value="40">40åˆ†</option><option value="50">50åˆ†</option><option value="60">60åˆ†</option>
                    <option value="90">90åˆ†</option><option value="120">2æ™‚é–“</option><option value="180">3æ™‚é–“</option>
                    <option value="240">4æ™‚é–“</option><option value="300">5æ™‚é–“</option><option value="360">6æ™‚é–“</option>
                </select>
            </div>
            <div class="mb-4 bg-orange-50 p-3 rounded border border-orange-200">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="input-is-base" class="w-5 h-5 text-orange-600 accent-orange-600">
                    <span class="font-bold text-sm text-orange-800">â˜… ã“ã“ã‚’æ™‚é–“ã®åŸºç‚¹ã«ã™ã‚‹</span>
                </label>
                <p class="text-xs text-orange-400 mt-1 pl-7">é›†åˆæ™‚é–“ã‚„äºˆç´„æ™‚é–“ãªã©ã€ç¢ºå®šã—ã¦ã„ã‚‹æ™‚é–“ã«ãƒã‚§ãƒƒã‚¯</p>
            </div>
            <div class="flex justify-end gap-2">
                <button onclick="closeModal('modal-stay')" class="px-4 py-2 text-orange-400">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="confirmStay()" class="px-6 py-2 bg-orange-600 text-white font-bold rounded shadow">OK</button>
            </div>
        </div>
    </div>

    <div id="modal-memo" class="hidden fixed inset-0 modal-bg z-50 flex items-center justify-center p-4 no-print">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6">
            <h3 class="text-lg font-bold mb-4 text-orange-900">ğŸ“ ãƒ¡ãƒ¢å…¥åŠ›</h3>
            <textarea id="input-memo" rows="3" class="w-full p-3 border border-orange-200 rounded mb-4 text-orange-900" placeholder="ãƒ¡ãƒ¢ã‚’å…¥åŠ›..."></textarea>
            <div class="flex justify-end gap-2">
                <button onclick="closeModal('modal-memo')" class="px-4 py-2 text-orange-400">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="confirmMemo()" class="px-6 py-2 bg-orange-600 text-white font-bold rounded shadow">OK</button>
            </div>
        </div>
    </div>

    <div id="modal-finalize" class="hidden fixed inset-0 modal-bg z-50 flex items-center justify-center p-4 no-print">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6">
            <h3 class="text-lg font-bold mb-4 text-orange-700">ğŸš€ ä»•ä¸Šã’è¨­å®š</h3>
            <div class="mb-3">
                <label class="block text-xs font-bold text-orange-400 mb-1">ãƒ—ãƒ©ãƒ³å</label>
                <input type="text" id="final-plan-name" class="w-full p-2 border border-orange-200 rounded font-bold text-orange-900" value="ãƒã‚¤æ—…ç¨‹ãƒ—ãƒ©ãƒ³">
            </div>
            <div class="mb-3">
                <label class="block text-xs font-bold text-orange-400 mb-1">åŸºç‚¹æ—¥æ™‚</label>
                <input type="datetime-local" id="final-base-time" class="w-full p-2 border border-orange-200 rounded font-bold text-orange-900">
            </div>
            <div class="mb-4">
                <label class="block text-xs font-bold text-orange-400 mb-1">æ™‚é–“è¡¨ç¤ºåˆ‡ä¸Šï¼ˆ0:07ã‚’0:10ã«ï¼‰</label>
                <select id="final-rounding" class="w-full p-2 border border-orange-200 rounded text-orange-900">
                    <option value="0">ãªã— (ãã®ã¾ã¾è¡¨ç¤º)</option>
                    <option value="5">5åˆ†å˜ä½</option>
                    <option value="10">10åˆ†å˜ä½</option>
                </select>
            </div>
            <div class="flex justify-end gap-2">
                <button onclick="closeModal('modal-finalize')" class="px-4 py-2 text-orange-400">æˆ»ã‚‹</button>
                <button onclick="executeCalculation()" class="px-6 py-2 bg-gradient-to-r from-orange-600 to-orange-700 text-white font-bold rounded shadow">ä½œæˆã™ã‚‹ï¼</button>
            </div>
        </div>
    </div>

    <datalist id="saved-locations-list"></datalist>

    <script>
        function initMap() { console.log("API Ready"); }
        const APP_VERSION = '5.4';
        
        let mode = 'DASHBOARD'; 
        let savedPlans = JSON.parse(localStorage.getItem('savedPlans_v2')) || [];
        let savedLocations = JSON.parse(localStorage.getItem('savedLocations_v2')) || [];
        let editingPlan = null;
        let editingIndex = -1; 
        let tempLocationData = null; 

        window.onload = () => {
            updateDatalist();
            checkUrlImport();
            if(mode === 'DASHBOARD') renderDashboard();
        };

        function triggerPrint() {
            window.print();
            return false;
        }

        function getSampleData() {
            const date = new Date(); date.setDate(date.getDate()+1);
            const ymd = date.toISOString().split('T')[0];
            return {
                id: 'sample', name: 'åƒè‘‰ã®ãƒ€ãƒ å·¡ã‚Š', baseTime: `${ymd}T12:00`, rounding: 0,
                stops: [
                    { type:'STOP', name:'æµ·ã»ãŸã‚‹SA', location:'æµ·ã»ãŸã‚‹PA', confirmed:true, stayTime:0, stayReason:'é›†åˆ', memo:'', isBase:false, timeStr:'07:40' },
                    { type:'MOVE', mode:'WAIT', duration:0, dist:0 }, 
                    { type:'STOP', name:'æµ·ã»ãŸã‚‹SA', location:'æµ·ã»ãŸã‚‹PA', confirmed:true, stayTime:0, stayReason:'', memo:'', isBase:false, timeStr:'08:00', depTimeStr:'08:00' },
                    { type:'MOVE', mode:'DRIVING_TOLL', duration:44, dist:0, roads:['æ±äº¬æ¹¾ã‚¢ã‚¯ã‚¢ãƒ©ã‚¤ãƒ³','é¤¨å±±è‡ªå‹•è»Šé“'], trafficBuffer:0 },
                    { type:'STOP', name:'çŸ¢é‚£å·ãƒ€ãƒ  å±•æœ›å°', location:'çŸ¢é‚£å·ãƒ€ãƒ ', confirmed:true, stayTime:20, stayReason:'çŸ¢é‚£å·ãƒ€ãƒ æ’®å½±', memo:'', isBase:false, timeStr:'08:50', depTimeStr:'09:10' },
                    { type:'MOVE', mode:'DRIVING_FREE', duration:49, dist:0, trafficBuffer:10 },
                    { type:'STOP', name:'é•·æŸ„ç”ºéƒ½å¸‚è¾²æ‘äº¤æµã‚»ãƒ³ã‚¿ãƒ¼', location:'é•·æŸ„ç”ºéƒ½å¸‚è¾²æ‘äº¤æµã‚»ãƒ³ã‚¿ãƒ¼', confirmed:true, stayTime:20, stayReason:'é•·æŸ„ãƒ€ãƒ æ’®å½±', memo:'ã‚«ãƒ¼ãƒ‰å–å¾—', isBase:false, timeStr:'10:00', depTimeStr:'10:20' },
                    { type:'MOVE', mode:'DRIVING_FREE', duration:27, dist:0, trafficBuffer:0 },
                    { type:'STOP', name:'é«˜æ»ãƒ€ãƒ è¨˜å¿µé¤¨', location:'é«˜æ»ãƒ€ãƒ è¨˜å¿µé¤¨', confirmed:true, stayTime:20, stayReason:'é«˜æ»ãƒ€ãƒ æ’®å½±', memo:'ã‚«ãƒ¼ãƒ‰å–å¾—', isBase:false, timeStr:'10:50', depTimeStr:'11:10' },
                    { type:'MOVE', mode:'DRIVING_FREE', duration:50, dist:0, trafficBuffer:0 },
                    { type:'STOP', name:'å‰²çƒ¹æ–™ç†ã€Œå¤©å¹³ã€', location:'å‰²çƒ¹æ–™ç†å¤©å¹³', confirmed:true, stayTime:60, stayReason:'æ˜¼é£Ÿ', memo:'ãªã‚ã‚ã†ã¨ã•ã‚“ãŒç„¼ããŒãŠè–¦ã‚', isBase:true, timeStr:'12:00', depTimeStr:'13:00' },
                    { type:'MOVE', mode:'DRIVING_FREE', duration:51, dist:0, trafficBuffer:0 },
                    { type:'STOP', name:'ç‰‡å€‰ãƒ€ãƒ ', location:'ç‰‡å€‰ãƒ€ãƒ ', confirmed:true, stayTime:10, stayReason:'ç‰‡å€‰ãƒ€ãƒ æ’®å½±', memo:'', isBase:false, timeStr:'14:00', depTimeStr:'14:10' },
                    { type:'MOVE', mode:'DRIVING_FREE', duration:10, dist:0, trafficBuffer:0 },
                    { type:'STOP', name:'äº€å±±ãƒ»ç‰‡å€‰ãƒ€ãƒ ç®¡ç†äº‹å‹™æ‰€', location:'äº€å±±ãƒ»ç‰‡å€‰ãƒ€ãƒ ç®¡ç†äº‹å‹™æ‰€', confirmed:true, stayTime:20, stayReason:'äº€å±±ãƒ€ãƒ æ’®å½±', memo:'äº€å±±ãƒ»ç‰‡å€‰ãƒ»çŸ¢é‚£å·ãƒ€ãƒ ã‚«ãƒ¼ãƒ‰å–å¾—', isBase:false, timeStr:'14:20', depTimeStr:'14:40' },
                    { type:'MOVE', mode:'DRIVING_TOLL', duration:44, dist:0, roads:['é¤¨å±±è‡ªå‹•è»Šé“','æ±äº¬æ¹¾ã‚¢ã‚¯ã‚¢ãƒ©ã‚¤ãƒ³'], trafficBuffer:0 },
                    { type:'STOP', name:'æµ·ã»ãŸã‚‹SA', location:'æµ·ã»ãŸã‚‹PA', confirmed:true, stayTime:0, stayReason:'', memo:'', isBase:false, timeStr:'15:30', depTimeStr:'' }
                ]
            };
        }

        function renderDashboard() {
            mode = 'DASHBOARD';
            let listHtml = '';
            if (savedPlans.length > 0) {
                savedPlans.forEach((p, i) => {
                    listHtml += `
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-orange-200 mb-4 flex justify-between items-center">
                        <div>
                            <div class="font-bold text-lg text-orange-900">${p.name}</div>
                            <div class="text-xs text-orange-400">${new Date(p.updatedAt).toLocaleDateString()} æ›´æ–°</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="sharePlan(${i})" class="text-xs bg-orange-50 text-orange-600 px-3 py-1.5 rounded hover:bg-orange-100">ğŸ”—</button>
                            <button onclick="deletePlan(${i})" class="text-xs bg-orange-50 text-orange-400 px-3 py-1.5 rounded hover:bg-orange-100">å‰Šé™¤</button>
                            <button onclick="openPlan(${i})" class="text-sm bg-orange-600 text-white px-4 py-1.5 rounded font-bold hover:bg-orange-700">é–‹ã</button>
                        </div>
                    </div>`;
                });
            } else {
                listHtml = `<div class="text-center text-orange-200 py-8">ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒ©ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“</div>`;
            }

            document.getElementById('app-content').innerHTML = `
                <div class="space-y-8 animate-fade-in">
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden cursor-pointer hover:shadow-xl transition" onclick="showSample()">
                        <div class="bg-gradient-to-r from-orange-400 to-orange-500 h-2"></div>
                        <div class="p-6 text-center">
                            <h3 class="text-xl font-extrabold text-orange-900 mb-1">åƒè‘‰ã®ãƒ€ãƒ å·¡ã‚Š</h3>
                            <p class="text-xs text-orange-400 mb-4">ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ãƒ³</p>
                            <div class="text-sm text-orange-600 font-bold">ğŸ‘€ è¦‹æœ¬ã‚’è¦‹ã‚‹ / ã“ã‚Œã‚’åŸºã«ä½œæˆ</div>
                        </div>
                    </div>
                    <button onclick="startNewEdit()" class="w-full py-4 bg-gradient-to-r from-orange-600 to-orange-700 text-white text-lg font-bold rounded-2xl shadow-lg hover:opacity-90 transform transition hover:-translate-y-1">
                        + æ–°ã—ã„æ—…ç¨‹ã‚’ä½œæˆã™ã‚‹
                    </button>
                    <div>
                        <h3 class="font-bold text-orange-800 mb-2 border-l-4 border-orange-500 pl-2">ğŸ“‚ ãƒã‚¤æ—…ã®ã—ãŠã‚Š</h3>
                        ${listHtml}
                    </div>
                </div>`;
        }

        function renderTimeline() {
            const isEdit = (mode === 'EDIT');
            const isSample = (mode === 'SAMPLE');
            const plan = editingPlan;
            
            let mapContainerHtml = (!isEdit) ? 
                `<div class="p-6 border-t border-orange-100 bg-orange-50 print:bg-white print:border-none">
                    <div class="text-sm font-bold text-orange-400 mb-2 no-print">ğŸ—ºï¸ ãƒ«ãƒ¼ãƒˆãƒãƒƒãƒ—</div>
                    <div class="bg-white rounded-xl h-64 w-full border border-orange-200 overflow-hidden shadow-inner print:shadow-none" id="full-map-area"></div>
                 </div>` : '';

            let html = `
                <div class="bg-white rounded-3xl shadow-xl overflow-hidden mb-8 min-h-
